# 模块1.2：变量初始化条目生成指令（Beta版）

## 模块定义

本模块在稳定版"变量初始化条目"的基础上，新增"数据结构安全"的约束能力。

**Beta 版特性**：
- 支持在 `[InitVar]` 的 JSON 数据中使用 `$meta`（对象）与 `$__META_EXTENSIBLE__$`（数组）
- 声明结构规则后，系统据此生成"模式（schema）"
- 在 LLM 执行 `_.insert` / `_.remove` 等结构性变更时进行校验
- 阻止未授权的结构变动

**重要说明**：
- 此文档适用于 MVU Beta 运行时
- 若运行环境为稳定版，请使用《1.1.变量初始化条目.md》
- 不要在稳定版中加入元信息键，否则可能作为普通数据被保存
- 初始化完成后，所有 `$meta` 与 `$__META_EXTENSIBLE__$` 将被移除，不会出现在后续的 `stat_data` 中

---

## 生成任务

根据以下规范和上下文，生成一个符合 `[InitVar]` 格式的 JSON5 数据块，并使用 Beta 版元信息进行结构约束。

---

## 语法与规则

### 1. 对象元信息：`$meta`（可选）

在对象中添加 `$meta` 键来声明结构规则：

**属性说明**：

- **`extensible`**: `boolean`，默认 `false`
  - `false`：对象结构锁定，禁止新增/删除键
  - `true`：对象结构开放，允许 `_.insert` 新增键、`_.remove` 删除键
  - 开启后该层子元素默认视为非必需，除非在 `required` 中另行指定

- **`required`**: `string[]`
  - 声明本层必需字段，禁止被删除
  - 列表中的键为必需项

- **`recursiveExtensible`**: `boolean`，默认 `false`
  - `true` 时对子孙对象穿透生效，直到遇到某层显式 `extensible: false`
  - 在当前层面，`recursiveExtensible: true` 等效于 `extensible: true`

- **`template`**: `object | array`
  - 用于 `_.insert` 新增结构时的模板合并
  - 自动补齐必要的子结构

**说明**：`$meta` 键完全可以不写，系统会采用默认值（对象锁定、非递归扩展、无必需项、空模板）。

### 2. 数组扩展标记：`$__META_EXTENSIBLE__$`

- 默认所有数组结构锁定
- 若数组内包含该特殊字符串，则视为可扩展
- 允许增删项
- 初始化后该字符串会被移除

---

## 示例模板

**注意**：参考格式并结合项目进行裁剪，不要照抄内容。

```json5
{
  "currentTime": "2025年07月15日 星期二 下午 02:00",
  "currentLocation": "山间小径",

  "baiYaoyao": {
    "$meta": {
      "extensible": false,
      "required": ["emotion", "thoughts", "outfit"],
      "template": {}
    },
    "emotion": "慵懒而欣喜",
    "thoughts": "这小东西总算回来了，不知这次又带了什么好吃的。",
    "outfit": "简约飘逸的白色汉服"
  },

  "memories": [
    "$__META_EXTENSIBLE__$",
    "雨中初遇"
  ],

  "world": {
    "$meta": {
      "extensible": true,
      "required": ["weather"],
      "recursiveExtensible": false,
      "template": {
        "event": { "name": "", "stage": 0 }
      }
    },
    "weather": "晴朗"
  }
}
```

---

## 输出要求

### 1. 主体内容

仅输出 JSON5 数据块，禁止使用注释。

### 2. 顶层结构

必须为对象（`{}`）。

### 3. 兼容提示

在 JSON5 数据块之后，另起一段提供以下说明：

#### a. Beta 运行时要求

"若项目加载了 MVU Beta 运行时，上述元信息将用于生成'模式'并在结构变更时校验；初始化后元信息会被移除。若未加载 Beta 运行时，请改用稳定版文档，不要包含 `$meta` 与 `$__META_EXTENSIBLE__$`。"

#### b. 存放位置

"此 JSON5 数据块应放置于世界书的任意条目中，该条目的名称必须包含 `[InitVar]` 标记（例如：`[InitVar]初始化`），且该条目无需启用。条目名称不应包含文件后缀。"

#### c. 系统集成

"与《3.2.变量处理指令集beta.md》配合使用，以启用 `_.add`、`_.insert`、`_.remove` 等增强命令和模式校验。与《2.变量更新规则.md》保持一致，初始化与更新逻辑分离。"

---

## 设计建议

1. **优先锁定**：对关键对象定义 `required` 与 `extensible`，优先锁定仅需读写值的层级
2. **谨慎扩展**：仅对确需动态增删项的数组放置 `$__META_EXTENSIBLE__$`，避免无意扩张结构
3. **模板准备**：如需批量创建同构子结构，准备好 `template` 以减少 LLM 构造出错
4. **分层控制**：使用 `recursiveExtensible` 可以快速设置整个分支的扩展性
5. **必需字段**：明确标记 `required` 字段，防止误删关键数据

---

## 生成指令

生成内容后，使用 Write 工具将 JSON5 数据块保存到 `变量初始化_beta.xyaml` 文件中。

---

## 额外要求

如用户有额外指示（如特定的结构约束、扩展性要求等），优先遵循用户的具体要求。
