# 模块3.1：变量处理指令集生成指令（稳定版）

## 模块定义

本模块负责生成一套标准的"变量处理指令集"。该指令集基于模块1（变量初始化）和模块2（变量更新规则），用于指导 AI 系统如何观察、分析并请求更新当前上下文中的动态变量。

**目标**：生成指令结构本身，而非执行变量更新

**版本说明**：
- 稳定版使用 `_.set` 基本更新命令
- 如需 `_.add`、`_.insert`、`_.remove` 等增强命令，请使用《3.2.变量处理指令集beta.md》

---

## 生成任务

严格按照下方提供的模板，输出完整的指令集内容。

---

## 指令集模板

```yaml
---
<status_current_variables>
{{get_message_variable::stat_data}}
</status_current_variables>
rule:
  - You should output the update analysis in the end of the next reply
  - if dest element is an array, only update and only output the first element, not `[]` block
  - When using _.set with objects or arrays, do NOT wrap them in quotes - use direct object/array literals (e.g., {key: value} or [item1, item2])
  - When using _.set with strings, DO wrap them in quotes (e.g., 'string value')
  - When using _.set with numbers or booleans, do NOT use quotes (e.g., 42, true, false)
format: |-
  <UpdateVariable>
    <Analysis>
      ${variable_path}: ${Whether the variable should be updated: 'Yes' or 'No'}
      ...
    </Analysis>
    _.set('${path_of_changed_variable}', ${old_value}, ${new_value}); // ${brief reason for change}
    ...
  </UpdateVariable>
example: |-
  <UpdateVariable>
    <Analysis>
      诗织.与平云的好感度: Yes
      世界.当前时间段: Yes
      诗织.内心迷茫指数: No
    </Analysis>
    _.set('诗织.与平云的好感度', 45, 52); // 平云的关心让诗织感到温暖
    _.set('世界.当前时间段', '放学后', '晚上'); // 时间流逝，进入夜晚
  </UpdateVariable>
```

---

## 输出要求

### 1. 结构一致性

最终输出必须与上述模板的结构和格式完全一致。

### 2. `example` 内容填充规则

- **变量替换**：示例中的变量名（如 `诗织.与平云的好感度`）仅为占位符，将其替换为模块1中定义的实际变量
- **`Analysis` 部分**：应列出所有在模块1中初始化的变量
- **更新标记**：在 `Analysis` 部分列出的所有变量中，标记为 'Yes' 的更新项不应超过3个
- **规则引用**：应结合模块2中定义的更新规则来指导变量更新判断

### 3. `_.set` 命令格式说明

**重要**：`_.set` 函数的参数格式因数据类型而异：

- **字符串类型**：需要用引号包裹
  ```javascript
  _.set('世界.当前时间段', '放学后', '晚上');
  ```

- **数值类型**：不要用引号，直接使用数字
  ```javascript
  _.set('诗织.与平云的好感度', 45, 52);
  ```

- **布尔类型**：不要用引号，直接使用 true/false
  ```javascript
  _.set('世界.是否下雨', false, true);
  ```

- **对象类型**：不要用引号，直接使用对象字面量
  ```javascript
  _.set('角色.属性', {力量: 10}, {力量: 15, 敏捷: 12});
  ```

- **数组类型**：不要用引号，直接使用数组字面量
  ```javascript
  _.set('背包.物品', ['剑'], ['剑', '盾牌']);
  ```

**错误示例**（会导致变量变成字符串）：
```javascript
// ❌ 错误：对象被加了引号
_.set('角色.属性', '{力量: 10}', '{力量: 15}');

// ❌ 错误：数组被加了引号
_.set('背包.物品', "['剑']", "['剑', '盾牌']");

// ✅ 正确：
_.set('角色.属性', {力量: 10}, {力量: 15});
_.set('背包.物品', ['剑'], ['剑', '盾牌']);
```

### 4. 附加说明

在完整输出指令集后，提供以下说明文字：

#### a. 使用位置

"此内容块应被放置在世界书的适当条目中（如[蓝灯 D1]），其作用是向 AI 提供当前变量列表，并说明变量更新的规则与格式。"

#### b. 系统集成

"该指令集整合了模块1的变量定义和模块2的更新规则，为 AI 提供完整的变量操作指导，是 MVU 系统运行的核心组件。"

#### c. 维护提示

"当模块1或模块2发生变化时，需要相应更新此指令集以保持系统一致性。"

---

## 生成指令

生成内容后，使用 Write 工具将指令集内容保存到 `变量处理指令集.xyaml` 文件中。

---

## 额外要求

如用户有额外指示（如特定的变量优先级、更新频率限制等），优先遵循用户的具体要求。
