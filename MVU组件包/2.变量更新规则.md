# 模块2：变量更新规则生成指令

## 模块定义

本模块专门负责定义变量的更新规则。这些规则与模块1的变量初始化分离，提供清晰的变量行为逻辑定义。

**格式**：YAML格式，为每个变量定义其类型、范围和检查条件

**优势**：与初始化分离，便于维护和修改更新逻辑

---

## 生成任务

根据以下模板格式，为模块1中定义的变量制定更新规则。

---

## YAML 格式规范

### 基本结构

```yaml
---
变量更新规则:
  ${变量名}:
    type: ${变量类型}
    range: ${范围和变化限制}
    check:
      - ${更新条件1}
      - ${更新条件2}
```

### 字段说明

- **`type`**：明确变量的数据类型
  - 基础类型：`string`、`number`、`boolean`
  - 复合类型：`object`、`array`
  - 也可以使用 TypeScript 类型定义（使用 `|-` 字符串块）

- **`range`**：定义变量的取值范围和约束条件
  - 数值范围：如 `capped in 0~100`
  - 格式要求：如 `格式为 mm月dd日`
  - 特殊约束：如 `remains unchanged when it's 100`

- **`check`**：列出触发变量更新的具体条件和规则
  - 每个条件占一行
  - 描述何时更新、如何更新
  - 根据实际需求确定条件数量，尽量简练

---

## 示例模板

**注意**：仅参考格式，根据模块1中定义的实际变量进行编写。

```yaml
---
变量更新规则:
  日期:
    type: string
    range: 格式为 mm月dd日，根据故事时间推进
    check:
      - 当故事时间推进时更新，通常在一天结束或新的一天开始时

  时间:
    type: string
    range: 格式为 hh:mm，24小时制
    check:
      - 每次行动或事件后根据实际经历的时间更新
      - 重大事件可能导致时间跳跃

  user:
    身份:
      type: string
      range: 描述性字符串，反映当前社会地位或职业
      check:
        - 完成特定任务或达成某些成就后更新
        - 重要剧情节点可能改变身份认知

    当前位置:
      type: string
      range: 具体地点名称
      check:
        - 当user移动到新区域时立即更新
        - 跟随user的移动行为

    重要经历:
      type: string
      range: 累积性记录，保留历史信息
      check:
        - 与核心人物发生重要互动时添加记录
        - 参与关键事件时添加记录
        - 采用追加方式，不覆盖之前的经历

    与理的好感度:
      type: number
      range: capped in -100~100
      check:
        - update it by ±(3~6) according to character '理''s attitudes towards user's behavior only if '理' is currently aware of it
        - 积极互动（帮助、关心、理解）增加好感度
        - 消极互动（伤害、忽视、误解）减少好感度

  理:
    当前位置:
      type: string
      range: 具体地点名称
      check:
        - 根据剧情需要和角色行为逻辑移动
        - 可能跟随user或有独立的移动模式

    情绪状态:
      pleasure:
        type: number
        range: capped in -1~1, -1极端痛苦，0中性，1极端喜悦
        check:
          - 正面事件和互动提升数值
          - 负面事件和冲突降低数值
          - 根据事件强度调整变化幅度

      arousal:
        type: number
        range: capped in -1~1, 代表生理或情绪上的激动程度
        check:
          - 刺激性、紧张或兴奋的事件提升数值
          - 平静、放松的情况降低数值
          - 与具体情境和角色反应相关

    当前所想:
      type: string
      range: 反映角色当前心理状态的思考内容
      check:
        - 每次重要互动后更新
        - 反映当前情绪状态和外部刺激
        - 体现角色的性格特点和当前关注点

  世界:
    当前事件阶段:
      type: number
      range: 整数，标记主要故事的进展阶段
      check:
        - 完成重要剧情节点时递增
        - 每个阶段对应不同的故事状态
        - 影响其他变量的行为模式

    天气:
      type: string
      range: 天气状况描述（晴朗、多云、小雨、雷暴、浓雾等）
      check:
        - 根据剧情需要和氛围要求更新
        - 可能影响角色行为和事件发生
        - 一般不频繁变化，除非有特殊剧情需要
```

---

## 输出要求

### 1. 主体内容

响应的主体部分应为完整的 YAML 格式变量更新规则定义。

### 2. 变量覆盖

- 应覆盖模块1中定义的所有变量
- 确保每个变量都有完整的更新规则定义
- 根据项目需求调整变量的更新逻辑

### 3. 规则设计原则

- **type**：明确变量的数据类型
- **range**：定义变量的取值范围和约束条件
- **check**：列出触发变量更新的具体条件和规则
- **简练性**：check 部分应简洁明了，避免过度扩展情况

### 4. 附加说明

在 YAML 数据块之后，提供以下信息：

#### a. 使用方式

"此更新规则文件用于指导 AI 模型在何时以及如何更新变量。应与模块1（变量初始化）和模块3（变量处理指令集）配合使用。"

#### b. 修改指南

"如需修改某个变量的更新规则，找到对应的变量路径，编辑其 type、range 或 check 部分。check 部分可以包含多个条件，每个条件占一行。"

#### c. 集成说明

"此规则文件应在模块3（变量处理指令集）中被引用，为 AI 提供明确的变量更新指导。通过模块化设计，实现了初始化、规则定义和指令执行的清晰分离。"

---

## 生成指令

生成内容后，使用 Write 工具将 YAML 规则定义保存到 `变量更新规则.xyaml` 文件中。

---

## 额外要求

如用户有额外指示（如特定的更新逻辑、约束条件等），优先遵循用户的具体要求。
